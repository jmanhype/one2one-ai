import{r as n,j as r}from"./index-2151265c.js";const d={"live-stream-container":"_live-stream-container_sh7ht_1","loading-spinner":"_loading-spinner_sh7ht_11","error-message":"_error-message_sh7ht_19","video-js":"_video-js_sh7ht_25"},T=({streamUrl:w})=>{const[o,u]=n.useState(null),[p,h]=n.useState(""),[m,g]=n.useState(""),l=n.useRef(null),e=n.useRef(null),f=async()=>{var v,y,x,S;const i={iceServers:document.getElementById("use-stun").checked?[{urls:["stun:stun.l.google.com:19302"]}]:[]};e.current=new RTCPeerConnection(i),e.current.addEventListener("connectionstatechange",()=>{e.current&&(g(e.current.connectionState),console.log("Connection state changed:",e.current.connectionState))}),e.current.addEventListener("track",t=>{t.track.kind==="video"&&l.current&&(l.current.srcObject=t.streams[0])});try{e.current.addTransceiver("audio",{direction:"recvonly"}),e.current.addTransceiver("video",{direction:"recvonly"});const t=await e.current.createOffer();console.log("Created offer:",t),await e.current.setLocalDescription(t),console.log("Sending offer to server:",{sdp:(v=e.current.localDescription)==null?void 0:v.sdp,type:(y=e.current.localDescription)==null?void 0:y.type});const s=await fetch(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sdp:(x=e.current.localDescription)==null?void 0:x.sdp,type:(S=e.current.localDescription)==null?void 0:S.type})});if(!s.ok){const j=await s.text();throw console.error("Server error response:",j),new Error(`Failed to send offer: ${s.status} ${s.statusText}. Server response: ${j}`)}const a=await s.json();if(console.log("Received answer from server:",a),!a.sdp||!a.type)throw new Error("Invalid answer received from server");await e.current.setRemoteDescription(new RTCSessionDescription(a)),console.log("Set remote description successfully")}catch(t){console.error("Streaming error:",t),u(`Failed to start streaming: ${t instanceof Error?t.message:String(t)}`)}},C=()=>{e.current&&(e.current.close(),e.current=null),g(""),console.log("Streaming stopped")},b=async c=>{c.preventDefault();try{if(!(await fetch(`http://${window.location.hostname}:8010/human`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:p,type:"chat",interrupt:!0})})).ok)throw new Error("Failed to send message");console.log("Message sent successfully"),h("")}catch(i){console.error("Error sending message:",i),u("Error sending message")}};return o?r.jsx("div",{className:d["error-message"],children:o}):r.jsxs("div",{className:d["live-stream-container"],children:[r.jsxs("div",{className:"option",children:[r.jsx("input",{id:"use-stun",type:"checkbox"}),r.jsx("label",{htmlFor:"use-stun",children:"Use STUN server"})]}),r.jsx("button",{onClick:f,children:"Start"}),r.jsx("button",{onClick:C,children:"Stop"}),m&&r.jsxs("div",{children:["Connection state: ",m]}),o&&r.jsxs("div",{children:[r.jsx("p",{className:d["error-message"],children:o}),r.jsx("button",{onClick:f,children:"Retry Connection"})]}),r.jsxs("form",{className:"form-inline",onSubmit:b,children:[r.jsx("textarea",{value:p,onChange:c=>h(c.target.value),placeholder:"Type your message here",rows:3,style:{width:"600px",height:"50px",color:"black"}}),r.jsx("button",{type:"submit",children:"Send"})]}),r.jsxs("div",{id:"media",children:[r.jsx("h2",{children:"Media"}),r.jsx("video",{ref:l,autoPlay:!0,playsInline:!0,style:{width:"600px"}})]})]})};export{T as default};
